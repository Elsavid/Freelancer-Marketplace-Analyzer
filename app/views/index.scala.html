@(request: play.mvc.Http.Request)

<!DOCTYPE html>
<html lang="en">

    <head>
        <title>FreeLancelot</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" media="screen" href='@routes.Assets.versioned("stylesheets/main.css")'>
        <link rel="stylesheet" media="screen" href='@routes.Assets.versioned("stylesheets/prism.css")'>
        <link rel="shortcut icon" type="image/png" href='@routes.Assets.versioned("images/favicon.png")'>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src='@routes.Assets.versioned("javascripts/prism.js")' type="text/javascript"></script>
    </head>

    <body>
        <section>
            <div class="centeredBlock searchBlock">
                <form id="searchForm">
                    <input class="searchBar" id="searchKeyWords" type="text" name="query" placeholder="Enter keywords here..." required></input>
                    <input class="searchButton" type="submit" value="Search"></input>
                </form>
            </div>
        </section>
        <section>
            <div class="centeredBlock">
                <table id="result" class="projectTable">
                        <!-- Placeholder for result -->
                </table>
            </div>
        </section>
    </body>
    <script>
            // Create WebSocket connection
            const ws = new WebSocket('ws://localhost:9000/ws');
            var displayTableHeading = false;

            // Listen for message
            ws.addEventListener("message", function (event) {
                console.log(event.data);
                var i, len, ref, resp, row, skill, skillsContainer;
                resp = JSON.parse(event.data);

                // Display the heading of the result table if not yet displayed
                if (!displayTableHeading) {
                    $('#result').append('<thead><tr><th>Owner</th><th>Sumbit date</th><th>Title</th><th>Skills</th></tr></thead>');
                    displayTableHeading = true;
                }
                // Create a row for a project
                row = $('<tr/>');
                row.append($('<td/>').append($('<a href="/owner/' + resp.owner_id + '">' + resp.owner_id + '</a>')));
                row.append($('<td/>').append(resp.submitdate));
                row.append($('<td/ class="projectTitle">').append(resp.title));
                skillsContainer = $('<td/>').append($('<table style="border:none"/>').append($('<tr/>')));
                ref = resp.skills;
                for (let i = 0; i < ref.length; i++) {
                    skill = ref[i];
                    skillsContainer.append($('<tr/>').append($('<td style="border:none">').append($('<a href="/skill/' + skill + '" style="text-decoration: none;" target="_blank">' + skill + '</a>'))));
                }
                row.append(skillsContainer);
                skillsContainer.append($('<hr />'));
                $('#result').append(row);
            });
            $("#searchForm").submit(function (event) {
                console.log("submit: " + $("#searchKeyWords").val());
                event.preventDefault();
                ws.send(JSON.stringify({
                    keywords: $("#searchKeyWords").val()
                }));
                return $("#searchKeyWords").val("");
            });

    </script>

</html>
